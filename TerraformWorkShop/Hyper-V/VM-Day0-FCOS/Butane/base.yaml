# yaml-language-server: $schema=https://raw.githubusercontent.com/Relativ-IT/Butane-Schemas/Release/Butane-Schema.json
variant: fcos
version: 1.5.0
storage:
  files:
    - path: /etc/hostname
      contents:
        inline: ${vm_name}
    # https://github.com/coreos/coreos-tutorials/blob/97376716dce47080dd9e8f016753c55c5c79da96/fedora-coreos/provisioning/fcos-lab-tutorial.bu#L48
    - path: /etc/ssh/sshd_config.d/20-enable-passwords.conf
      contents:
        inline: |
          # Fedora CoreOS disables SSH password login by default.
          # Enable it.
          # This file must sort before 40-disable-passwords.conf.
          PasswordAuthentication yes
    # low down the unprivilege port
    - path: /etc/sysctl.d/90-unprivileged_port_start.conf
      contents:
        inline: |
          net.ipv4.ip_unprivileged_port_start = 53
    # prevent zincati service reboot system immediately
    - path: /etc/zincati/config.d/30-updates-strategy.toml
      contents:
        inline: |
          # How to finalize updates.
          [updates]

          # String to customize update strategy.
          # Default strategy is to immediately finalize updates as soon as available,
          # and reboot the node.
          #strategy = "immediate"

          # Update strategy which uses an external reboot coordinator (FleetLock protocol).
          #strategy = "fleet_lock"
          # Base URL for the FleetLock service.
          #fleet_lock.base_url = "https://fleet-lock.example.com/"

          # Update strategy which uses a periodic schedule for reboot/maintenance
          # windows, on a weekly basis.
          strategy = "periodic"
          # Example of reboot windows: weekend days, between 01:00 and 02:00 UTC.
          [[updates.periodic.window]]
          days = [ "Sat", "Sun" ]
          start_time = "01:00"
          length_minutes = 60
  links:
    - path: /etc/localtime
      target: ../usr/share/zoneinfo/${timezone}
