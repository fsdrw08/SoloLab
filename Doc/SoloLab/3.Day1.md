### Sync Day1 related container images to zot
[LocalWorkShop/Sync-OCIImage](../../LocalWorkShop/Sync-OCIImage/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="LocalWorkShop/Sync-OCIImage"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
$proxy="127.0.0.1:7890"; $env:HTTP_PROXY=$proxy; $env:HTTPS_PROXY=$proxy; $env:NO_PROXY="sololab,consul"
.\Sync-OCIImage.ps1 -PrivateRegistry "zot.day0.sololab" -SyncProfile "Day1.jsonc" # -Upload $false
# .\Sync-OCIImage.ps1 -PrivateRegistry "zot.day0.sololab" -SyncProfile "Day1.jsonc" -LocalStore "D:/Users/Public/Downloads/containers" -Upload $false
```

### Create Day1-FCOS VM
[TerraformWorkShop/Hyper-V/VM-Day1-FCOS](../../TerraformWorkShop/Hyper-V/VM-Day1-FCOS/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Hyper-V/VM-Day1-FCOS"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Config PKI Root CA in Vault
[TerraformWorkShop/Vault/Secrets/PKI/RootCA](../../TerraformWorkShop/Vault/Secrets/PKI/RootCA/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Vault/Secrets/PKI/RootCA"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Config PKI intermediate CA in Vault
[TerraformWorkShop/Vault/Secrets/PKI/Int_CA](../../TerraformWorkShop/Vault/Secrets/PKI/Int_CA)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Vault/Secrets/PKI/Int_CA"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Create certs in Vault
[TerraformWorkShop/Vault/Secrets/PKI/certs](../../TerraformWorkShop/Vault/Secrets/PKI/certs/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Vault/Secrets/PKI/certs"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Config Consul secret backend / gossip key secret for Consul in Vault
[TerraformWorkShop/Vault/Secrets/Consul](../../TerraformWorkShop/Vault/Secrets/Consul/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Vault/Secrets/Consul/"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy Consul server to Day1 VM
[TerraformWorkShop/Quadlet/consul-server](../../TerraformWorkShop/Quadlet/consul-server/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/consul-server"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Update ACL policy and CA config in Consul
[TerraformWorkShop/Consul/ACL](../../TerraformWorkShop/Consul/ACL)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Consul/ACL"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy Traefik proxy in Day1 VM
[TerraformWorkShop/Quadlet/traefik-day1](../../TerraformWorkShop/Quadlet/traefik-day1/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/traefik-day1"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

<!-- 
### 14. Deploy Consul-Template in Day1 VM
[TerraformWorkShop/Quadlet/consul-template](../../TerraformWorkShop/Quadlet/consul-template/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/consul-template"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
``` -->

### Deploy consul client to Day0 VM
[TerraformWorkShop/Quadlet/consul-client](../../TerraformWorkShop/Quadlet/consul-client/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/consul-client"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy consul client to VyOS VM
[TerraformWorkShop/VyOS/consul-client](../../TerraformWorkShop/VyOS/Container-Consul)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/VyOS/Container-Consul"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```
<!-- 
### Config Minio IAM and bucket in Day0 MinIO
[TerraformWorkShop/MinIO/IAM](../../TerraformWorkShop/MinIO/IAM/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/MinIO/IAM"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
``` -->

### Upload files to dufs
- Sync files to dufs [LocalWorkShop/SyncTo-Dufs/SyncTo-Dufs.ps1](../../LocalWorkShop/SyncTo-Dufs/SyncTo-Dufs.ps1)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="LocalWorkShop/SyncTo-Dufs"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
$proxy="127.0.0.1:7890"; $env:HTTP_PROXY=$proxy; $env:HTTPS_PROXY=$proxy; $env:NO_PROXY="sololab,consul"
.\SyncTo-Dufs.ps1 -SyncProfile "Day1.jsonc" # -Upload $false
# .\SyncTo-Dufs.ps1 -SyncProfile "Day1.jsonc" -LocalStore "D:/Users/Public/Downloads/bin"
```

### Deploy Grafana to Day1 VM
[TerraformWorkShop/Quadlet/grafana/](../../TerraformWorkShop/Quadlet/grafana/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/grafana/"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy Loki in Day1 VM
[TerraformWorkShop/Quadlet/loki](../../TerraformWorkShop/Quadlet/loki/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/loki"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy Alloy in Day0 VM
[TerraformWorkShop/Quadlet/alloy](../../TerraformWorkShop/Quadlet/alloy/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/alloy"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy Prometheus in Day1 VM
[TerraformWorkShop/Quadlet/prometheus](../../TerraformWorkShop/Quadlet/prometheus/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/prometheus"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy Prometheus Exporters in Day1 VM
[TerraformWorkShop/Quadlet/exporters-day1](../../TerraformWorkShop/Quadlet/exporters-day1/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/exporters-day1"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Add dashboard to Grafana
[TerraformWorkShop/Grafana/Dashboard](../../TerraformWorkShop/Grafana/Dashboard/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Grafana/Dashboard"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy Nomad server to Day1 VM
[TerraformWorkShop/Quadlet/nomad](../../TerraformWorkShop/Quadlet/nomad/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Quadlet/nomad"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Config Nomad OIDC login and add management token
copy nomad root token from Day1 VM
```shell
ssh Day1-FCOS
less /home/podmgr/.local/share/containers/storage/volumes/nomad-pvc/_data/server/nomad_token
```
Open [TerraformWorkShop/Nomad/ACL](../../TerraformWorkShop/Nomad/ACL/) in terminal, run
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Nomad/ACL"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
$env:NOMAD_TOKEN="xxx"
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```  

### Config Vault JWT auth for nomad
[TerraformWorkShop/Vault/Auth/JWT](../../TerraformWorkShop/Vault/Auth/JWT)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Vault/Auth/JWT"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Config Consul JWT auth for nomad
[TerraformWorkShop/Vault/Auth/JWT](../../TerraformWorkShop/Consul/Auth/JWT)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Consul/Auth/JWT"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```
<!-- 
### Deploy Nomad client to Day1 VM
[TerraformWorkShop/System/nomad-client/](../../TerraformWorkShop/System/nomad-client/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/System/nomad-client"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

### Deploy nomad nfs csi controller
[TerraformWorkShop/Nomad/Jobs/nfs-controller/](../../TerraformWorkShop/Nomad/Jobs/nfs-controller/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Nomad/Jobs/nfs-controller"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)

# get nomad token
$credential = Get-Credential -Message "credential to login vault"

$vaultBaseUri = New-Object System.Uri("https://vault.day0.sololab/")
$vaultLoginUri = New-Object System.Uri($vaultBaseUri, "/v1/auth/ldap/login/$($credential.UserName)")
$vaultLoginUri.AbsoluteUri
$vaultToken = $(curl.exe -k -s --request POST `
    --data "{`"password`": `"$($credential.GetNetworkCredential().Password)`"}" `
    $vaultLoginUri | jq.exe .auth.client_token).Replace('"', '')
# get nomad token from kvv2 secret backend
$vaultSecretUri = New-Object System.Uri($vaultBaseUri, "/v1/kvv2_nomad/data/token-management")
$env:NOMAD_TOKEN = $(curl.exe -k -s -X GET `
    -H "X-Vault-Token: $VaultToken" `
    $vaultSecretUri.AbsoluteUri | jq.exe .data.data.token ).Replace('"', '')

# sudo pwsh.exe -c "terraform init -upgrade";
# terraform apply ...
```

 -->