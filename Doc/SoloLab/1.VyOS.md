### 1. Provision VyOS VM image by packer
[PackerWorkShop/VyOS](../../PackerWorkShop/VyOS)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="PackerWorkShop/VyOS"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# packer init .\plugins.pkr.hcl
.\Invoke-PackerBuild.ps1 '15s-cloudinit'
```

### 2. Prepare Terraform Plugins
[TerraformWorkShop](../../TerraformWorkShop/README.md)

### 3. Create Hyper-V Internal Switch
[TerraformWorkShop/Hyper-V/Switch-Internal](../../TerraformWorkShop/Hyper-V/Switch-Internal/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Hyper-V/Switch-Internal"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```

### 4. Prepare ssh config
Copy dir [LocalWorkShop/.ssh](../../LocalWorkShop/.ssh/) to user home dir

### 5. Create data disks
[TerraformWorkShop/Hyper-V/Disks-Data](../../TerraformWorkShop/Hyper-V/Disks-Data/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Hyper-V/Disks-Data"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```

### 6. Create and trust private root CA
[TerraformWorkShop/TLS/RootCA](../../TerraformWorkShop/TLS/RootCA/)
run:
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/TLS/RootCA"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```
After provisioned resources in this dir, install the root.crt to trust ca dir.

### 7. Create VyOS VM
[TerraformWorkShop/Hyper-V/VM-VyOS](../../TerraformWorkShop/Hyper-V/VM-VyOS/)  
Then config shellcrash if need [TerraformWorkShop\Hyper-V\VM-VyOS\shellclash\README.md](../../TerraformWorkShop/Hyper-V/VM-VyOS/shellclash/README.md)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Hyper-V/VM-VyOS"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```

### 8. Deploy zot image registry in VyOS VM
[TerraformWorkShop/Quadlet/zot/](../../TerraformWorkShop/VyOS/Container-Zot/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/VyOS/Container-Zot"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```

### 9. Sync container image to zot
[LocalWorkShop/Sync-OCIImage/Sync-OCIImage.ps1](../../LocalWorkShop/Sync-OCIImage/Sync-OCIImage.ps1)

### 10. Sync trivy-db to zot
[LocalWorkShop/Sync-OCIImage/Sync-TrivyDB.ps1](../../LocalWorkShop/Sync-OCIImage/Sync-TrivyDB.ps1)


### 11. Deploy CoreDNS in VyOS
[TerraformWorkShop/VyOS/Container-CoreDNS](../../TerraformWorkShop/VyOS/Container-CoreDNS/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/VyOS/Container-CoreDNS"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```

### 12. Deploy PowerDNS server in VyOS
[TerraformWorkShop/VyOS/Container-PowerDNS/](../../TerraformWorkShop/VyOS/Container-PDNS-Auth/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/VyOS/Container-PDNS-Auth"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```

### 13. Deploy Lynx server in VyOS
[TerraformWorkShop/VyOS/Container-Lynx](../../TerraformWorkShop/VyOS/Container-Lynx)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/VyOS/Container-Lynx"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```

### 14. Init Lynx
1. Go to https://lynx.vyos.sololab, input:
```yaml
Application Name: Lynx
Application URL: https://lynx.vyos.sololab
Application Email: lynx@mail.sololab
Admin Email:  root@mail.sololab
Admin Password: # ref from [TerraformWorkShop/LDAP/lldap/terraform.tfvars](../../TerraformWorkShop/LDAP/lldap/terraform.tfvars)
```
2. Go to top right corner -> profile -> show the Key (in right side), copy the api key
3. Create user, team, project, environment in lync [TerraformWorkShop/Lynx/vyos](../../TerraformWorkShop/Lynx/vyos/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Lynx/vyos"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
```

### 13. Seed DNS record to PowerDNS
[TerraformWorkShop/PowerDNS/zones](../../TerraformWorkShop/PowerDNS/zones)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/PowerDNS/zones"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```

### 14. Config haproxy in VyOS
[TerraformWorkShop/VyOS/HAProxy](../../TerraformWorkShop/VyOS/HAProxy/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/VyOS/HAProxy"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# terraform init; terraform apply ...
```
