### Sync CI node related container images to zot
[LocalWorkShop/Sync-OCIImage](../../LocalWorkShop/Sync-OCIImage/Sync-OCIImage.ps1)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="LocalWorkShop/Sync-OCIImage"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
$proxy="127.0.0.1:7890"; $env:HTTP_PROXY=$proxy; $env:HTTPS_PROXY=$proxy; $env:NO_PROXY="sololab,consul"
.\Sync-OCIImage.ps1 -PrivateRegistry "zot.day0.sololab" -SyncProfile "CI.jsonc" # -Upload $false
# .\Sync-OCIImage.ps1 -PrivateRegistry "zot.day0.sololab" -SyncProfile "CI.jsonc" -LocalStore "D:/Users/Public/Downloads/containers" -Upload $false
```


### Create CI-FCOS VM
[TerraformWorkShop/Hyper-V/VM-CI-FCOS](../../TerraformWorkShop/Hyper-V/VM-CI-FCOS/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Hyper-V/VM-CI-FCOS"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)

# get consul kv token from vault
# login vault
$credential = Get-Credential -Message "credential to login vault"

$vaultBaseUri = New-Object System.Uri("https://vault.day0.sololab/")
$vaultLoginEndpoint = "/v1/auth/ldap/login/$($credential.UserName)"
$vaultLoginUri = New-Object System.Uri($vaultBaseUri, "/v1/auth/ldap/login/$($credential.UserName)")
$vaultLoginUri.AbsoluteUri
$vaultToken = $(curl.exe -k -s --request POST `
    --data "{`"password`": `"$($credential.GetNetworkCredential().Password)`"}" `
    $vaultLoginUri | jq.exe .auth.client_token).Replace('"', '')
# get consul kv token from kvv2 secret backend
$vaultSecretUri = New-Object System.Uri($vaultBaseUri, "/v1/kvv2_consul/data/token-tf_backend")
$env:CONSUL_HTTP_TOKEN = $(curl.exe -k -s -X GET `
    -H "X-Vault-Token: $vaultToken" `
    $vaultSecretUri.AbsoluteUri | jq.exe .data.data.token ).Replace('"', '')

sudo pwsh.exe -c "[System.Environment]::SetEnvironmentVariable('CONSUL_HTTP_TOKEN',`"$env:CONSUL_HTTP_TOKEN`"); terraform init"
terraform apply
```

### Deploy nfs-nodes nomad job
[TerraformWorkShop/Nomad/Jobs/nfs-nodes/](../../TerraformWorkShop/Nomad/Jobs/nfs-nodes/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Nomad/Jobs/nfs-nodes/"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)

# get nomad management token from vault
# login vault
$credential = Get-Credential -Message "credential to login vault"

$vaultBaseUri = New-Object System.Uri("https://vault.day0.sololab/")
$vaultLoginEndpoint = "/v1/auth/ldap/login/$($credential.UserName)"
$vaultLoginUri = New-Object System.Uri($vaultBaseUri, "/v1/auth/ldap/login/$($credential.UserName)")
$vaultLoginUri.AbsoluteUri
$vaultToken = $(curl.exe -k -s --request POST `
    --data "{`"password`": `"$($credential.GetNetworkCredential().Password)`"}" `
    $vaultLoginUri | jq.exe .auth.client_token).Replace('"', '')
# get nomad token from kvv2 secret backend
$vaultSecretUri = New-Object System.Uri($vaultBaseUri, "/v1/kvv2_nomad/data/token-management")
$env:NOMAD_TOKEN = $(curl.exe -k -s -X GET `
    -H "X-Vault-Token: $vaultToken" `
    $vaultSecretUri.AbsoluteUri | jq.exe .data.data.token ).Replace('"', '')

# sudo pwsh.exe -c "[System.Environment]::SetEnvironmentVariable('CONSUL_HTTP_TOKEN',`"$env:CONSUL_HTTP_TOKEN`"); terraform init"; 
# terraform apply ...
```

### Deploy gitblit nomad job
[TerraformWorkShop/Nomad/Jobs/gitblit/](../../TerraformWorkShop/Nomad/Jobs/gitblit/)
```powershell
$repoDir=git rev-parse --show-toplevel
$childPath="TerraformWorkShop/Nomad/Jobs/gitblit/"
Set-Location -Path (Join-Path -Path $repoDir -ChildPath $childPath)
# sudo pwsh.exe -c "[System.Environment]::SetEnvironmentVariable('CONSUL_HTTP_TOKEN',`"$env:CONSUL_HTTP_TOKEN`"); terraform init"; 
# terraform apply ...
```